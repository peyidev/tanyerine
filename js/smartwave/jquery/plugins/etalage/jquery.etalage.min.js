!function(t){t.fn.etalage=function(a){var e=t.extend({align:"left",thumb_image_width:300,thumb_image_height:400,source_image_width:900,source_image_height:1200,zoom_area_width:600,zoom_area_height:"justify",zoom_area_distance:10,zoom_easing:!0,click_to_zoom:!1,zoom_element:"auto",zoom_enable:!0,show_descriptions:!0,description_location:"bottom",description_opacity:.7,small_thumbs:3,small_thumbs_width_offset:0,smallthumb_inactive_opacity:.4,smallthumb_hide_single:!0,smallthumb_select_on_hover:!1,smallthumbs_position:"bottom",show_begin_end_smallthumb:!0,magnifier_opacity:.5,magnifier_invert:!0,show_icon:!0,icon_offset:20,hide_cursor:!1,show_hint:!1,hint_offset:15,speed:600,autoplay:!0,autoplay_interval:6e3,keyboard:!0,right_to_left:!1,click_callback:function(){return!0},change_callback:function(){return!0}},a);return t.each(this,function(){function a(t){y=y?y-1:0,w=!0;var a,e,i,s,l=o.find(".etalage_smallthumb_first").removeClass("etalage_smallthumb_first"),n=o.find(".etalage_smallthumb_last").removeClass("etalage_smallthumb_last");"left"===t?(a=l.prev().addClass("etalage_smallthumb_first"),e=n.prev().addClass("etalage_smallthumb_last"),i=l):(a=l.next().addClass("etalage_smallthumb_first"),e=n.next().addClass("etalage_smallthumb_last"),i=n),y?"left"===t?a.trigger("click"):e.trigger("click"):(s="vert"===W?a.position().top:a.position().left,Ot(s,a,e,i))}function i(t){w=!0;var a,e,i;o.find(".etalage_smallthumb_first").removeClass("etalage_smallthumb_first"),o.find(".etalage_smallthumb_last").removeClass("etalage_smallthumb_last");"end"===t?(a=P.eq(U-V).addClass("etalage_smallthumb_first"),i=e=P.eq(U-1).addClass("etalage_smallthumb_last"),e.hasClass("etalage_smallthumb_navtostart")&&(i=e.prev())):(a=P.eq(0).addClass("etalage_smallthumb_first"),e=P.eq(V-1).addClass("etalage_smallthumb_last"),i=a,a.hasClass("etalage_smallthumb_navtoend")&&(i=a.next()));var s="vert"===W?a.position().top:a.position().left;Ot(s,a,e,i)}function s(){i("start")}function l(){i("end")}var o=t(this);if(o.is("ul")&&o.children("li").length&&o.find("img.etalage_source_image").length){var n,r,h,c,m,_,d,g,u,f,p=o.attr("id"),b=Math.floor(.7*e.speed),v=Math.round(e.speed/100),w=!1,y=0,I=!1,C=!0,k=!1,T=0,z=0,q=0,R=0,L=0,W="hori";void 0!==p&&p||(p="[no id]"),"left"!==e.smallthumbs_position&&"right"!==e.smallthumbs_position||(W="vert"),"object"==typeof t.browser&&t.browser.msie&&t.browser.version<9&&(C=!1,t.browser.version<7&&(I=!0)),o.addClass("etalage").show();var x;x=o.children("li").first().hasClass("etalage_thumb")?o.children("li.etalage_thumb"):o.children("li").addClass("etalage_thumb"),o.children("li.etalage_thumb_active").hide().removeClass("etalage_thumb_active"),x.first().show().addClass("etalage_thumb_active").css("opacity",1);var M=x.length,j=e.autoplay;M<2&&(j=!1),"right"===e.align&&o.addClass("etalage_right"),t.each(x,function(a){a+=1;var e=t(this),i=e.find(".etalage_thumb_image").show(),s=e.find(".etalage_source_image"),l=e.find("a");e.data("id",a).addClass("thumb_"+a),!i.length&&s.length?e.prepend('<img class="etalage_thumb_image" src="'+s.attr("src")+'" />'):i.length||s.length||e.remove(),l.length&&e.find(".etalage_thumb_image").data("anchor",l.attr("href"))});var B=x.find(".etalage_thumb_image").css({width:e.thumb_image_width,height:e.thumb_image_height}).show();t.each(B,function(){t(this).data("src",this.src),t(this).data("title",this.alt)});var O;o.children("li.etalage_magnifier").remove();var A,H=(O=t('<li class="etalage_magnifier"><div><img /></div></li>').appendTo(o)).children("div"),Q=H.children("img");o.children("li.etalage_icon").remove(),A=t('<li class="etalage_icon">&nbsp;</li>').appendTo(o),e.show_icon&&A.show();var X;e.show_hint&&(o.children("li.etalage_hint").remove(),X=t('<li class="etalage_hint">&nbsp;</li>').appendTo(o).show());var Y,D=e.zoom_element;"auto"!==D&&D&&t(D).length?Y=t(D).addClass("etalage_zoom_area").html('<div><img class="etalage_zoom_img" /></div>'):(D="auto",o.children("li.etalage_zoom_area").remove(),Y=t('<li class="etalage_zoom_area"><div><img class="etalage_zoom_img" /></div></li>').appendTo(o));var E,F=Y.children("div");C&&(E=t('<img class="etalage_zoom_preview" />').css({width:e.source_image_width,height:e.source_image_height,opacity:.3}).prependTo(F).show());var G,J=F.children(".etalage_zoom_img").css({width:e.source_image_width,height:e.source_image_height});e.show_descriptions&&(G=t('<div class="etalage_description'+(e.right_to_left?" rtl":"")+'"></div>').prependTo(Y));var K,N,P,S,U,V=e.small_thumbs,Z=e.small_thumbs_width_offset;(M>1||!e.smallthumb_hide_single)&&(o.children("li.etalage_small_thumbs").remove(),K=t('<li class="etalage_small_thumbs"><ul></ul></li>').appendTo(o),N=K.children("ul"),t.each(B,function(){var a=t(this);h=a.data("src"),title=a.data("title"),c=a.parents(".etalage_thumb").data("id"),t('<li title="'+title+'"><img class="etalage_small_thumb" src="'+h+'" /></li>').data("thumb_id",c).appendTo(N)}),P=N.children("li").css({opacity:e.smallthumb_inactive_opacity}),V<3&&(V=3),M>V?(e.show_begin_end_smallthumb?(h=B.eq(M-1).data("src"),title=B.eq(M-1).data("title"),c=x.eq(M-1).data("id"),t('<li class="etalage_smallthumb_first etalage_smallthumb_navtoend" title="'+title+'"><img class="etalage_small_thumb" src="'+h+'" /></li>').data("src",h).data("thumb_id",c).css({opacity:e.smallthumb_inactive_opacity}).prependTo(N),h=B.eq(0).data("src"),title=B.eq(0).data("title"),c=x.eq(0).data("id"),t('<li class="etalage_smallthumb_navtostart" title="'+title+'"><img class="etalage_small_thumb" src="'+h+'" /></li>').data("src",h).data("thumb_id",c).css({opacity:e.smallthumb_inactive_opacity}).appendTo(N),(P=N.children("li")).eq(1).addClass("etalage_smallthumb_active").css({opacity:1})):P.eq(0).addClass("etalage_smallthumb_first etalage_smallthumb_active").css({opacity:1}),P.eq(V-1).addClass("etalage_smallthumb_last")):P.eq(0).addClass("etalage_smallthumb_active").css({opacity:1}),t.each(P,function(a){t(this).data("id",a+1)}),S=P.children("img"),U=P.length,"vert"===W&&P.addClass("vertical")),m=e.magnifier_invert?1:e.magnifier_opacity;var $=parseInt(x.css("borderLeftWidth"),10)+parseInt(x.css("borderRightWidth"),10)+parseInt(B.css("borderLeftWidth"),10)+parseInt(B.css("borderRightWidth"),10),tt=parseInt(x.css("marginLeft"),10)+parseInt(x.css("marginRight"),10),at=parseInt(x.css("paddingLeft"),10)+parseInt(x.css("paddingRight"),10)+parseInt(B.css("marginLeft"),10)+parseInt(B.css("marginRight"),10)+parseInt(B.css("paddingLeft"),10)+parseInt(B.css("paddingRight"),10),et=e.thumb_image_width+$+tt+at,it=e.thumb_image_height+$+tt+at,st=0,lt=0,ot=0,nt=0,rt=0,ht=0,ct=0;(M>1||!e.smallthumb_hide_single)&&(st=parseInt(P.css("borderLeftWidth"),10)+parseInt(P.css("borderRightWidth"),10)+parseInt(S.css("borderLeftWidth"),10)+parseInt(S.css("borderRightWidth"),10),lt=parseInt(P.css("marginTop"),7),ot=parseInt(P.css("paddingLeft"),10)+parseInt(P.css("paddingRight"),10)+parseInt(S.css("marginLeft"),7)+parseInt(S.css("marginRight"),7)+parseInt(S.css("paddingLeft"),10)+parseInt(S.css("paddingRight"),10),"vert"===W?(rt=Math.round((it-(V-1)*lt)/V)-(st+ot),ht=(nt=Math.round(e.thumb_image_width*rt/e.thumb_image_height))+st+ot,ct=rt+st+ot):(ht=(nt=Math.round((et+Z-(V-1)*lt)/V)-(st+ot))+st+ot,ct=(rt=Math.round(e.thumb_image_height*nt/e.thumb_image_width))+st+ot));var mt,_t,dt=parseInt(Y.css("borderTopWidth"),10),gt=parseInt(e.zoom_area_distance,10),ut=parseInt(Y.css("paddingTop"),10);mt=e.zoom_area_width-2*dt-2*ut>e.source_image_width?e.source_image_width:e.zoom_area_width-2*dt-2*ut,(_t="justify"===e.zoom_area_height?it+lt+ct-2*dt-2*ut:e.zoom_area_height-2*dt-2*ut)>e.source_image_height&&(_t=e.source_image_height);var ft;e.show_descriptions&&(ft=mt-(parseInt(G.css("borderLeftWidth"),10)+parseInt(G.css("borderRightWidth"),10))-(parseInt(G.css("marginLeft"),10)+parseInt(G.css("marginRight"),10))-(parseInt(G.css("paddingLeft"),10)+parseInt(G.css("paddingRight"),10)));var pt;I&&(pt=t('<iframe marginwidth="0" marginheight="0" scrolling="no" frameborder="0" src="javascript:\'<html></html>\'"></iframe>').css({position:"absolute",zIndex:1}).prependTo(Y));var bt=parseInt(O.css("borderTopWidth"),10),vt=parseInt(x.css("borderTopWidth"),10)+parseInt(x.css("marginTop"),10)+parseInt(x.css("paddingTop"),10)+parseInt(B.css("borderTopWidth"),10)+parseInt(B.css("marginTop"),10)-bt,wt=B.offset().left-o.offset().left-bt;"left"===e.smallthumbs_position?wt=wt+ht+lt:"top"===e.smallthumbs_position&&(vt=vt+ct+lt);var yt,It,Ct=Math.round(mt*(e.thumb_image_width/e.source_image_width)),kt=Math.round(_t*(e.thumb_image_height/e.source_image_height)),Tt=vt+e.thumb_image_height-kt,zt=wt+e.thumb_image_width-Ct,qt=Math.round(Ct/2),Rt=Math.round(kt/2);if(e.show_hint&&(yt=parseInt(e.hint_offset,10)+parseInt(X.css("marginTop"),10),It=parseInt(e.hint_offset,10)+parseInt(X.css("marginRight"),10),"right"===e.smallthumbs_position&&(It=It-ht-lt)),"vert"===W?(g=et+lt+ht,o.css({width:g,height:it})):(g=et,o.css({width:g,height:it+lt+ct})),e.show_icon&&(f={top:it-A.outerHeight(!0)-parseInt(e.icon_offset,10),left:parseInt(e.icon_offset,10)},"left"===e.smallthumbs_position?f.left=ht+lt+parseInt(e.icon_offset,10):"top"===e.smallthumbs_position&&(f.top+=ct+lt),A.css(f)),e.show_hint&&X.css({margin:0,top:-yt,right:-It}),Q.css({margin:0,padding:0,width:e.thumb_image_width,height:e.thumb_image_height}),H.css({margin:0,padding:0,width:Ct,height:kt}),f={margin:0,padding:0,left:(zt-wt)/2,top:(Tt-vt)/2},"left"===e.smallthumbs_position?f.left="+="+ht+lt:"top"===e.smallthumbs_position&&(f.top="+="+ct+lt),O.css(f).hide(),F.css({width:mt,height:_t}),f={margin:0,opacity:0},"right"===e.align&&"auto"===D?f.left=-(mt+2*dt+2*ut+gt):"auto"===D&&(f.left=g+gt),Y.css(f).hide(),e.show_descriptions&&(f={width:ft,bottom:ut,left:ut,opacity:e.description_opacity},"top"===e.description_location&&(f.top=ut,f.bottom="auto"),G.css(f).hide()),M>1||!e.smallthumb_hide_single)if("vert"===W?(f={top:0,height:it},"left"===e.smallthumbs_position?x.css({left:ht+lt}):f.marginLeft=et+lt,K.css(f),N.css({height:ct*U+U*lt+100}),S.css({width:nt,height:rt}).attr("height",rt),P.css({margin:0,marginBottom:lt})):(f={width:et+Z,left:-Z/2},"top"===e.smallthumbs_position?x.css({top:ct+lt}):f.top=it+lt,K.css(f),N.css({width:ht*U+U*lt+100}),S.css({width:nt,height:rt}).attr("width",nt),P.css({margin:0,marginRight:lt})),(u="vert"===W?ct*V+(V-1)*lt-it:ht*V+(V-1)*lt-et)>0)for(n=1;n<=U-1;n+=V-1)for(r=1;r<=u;r+=1)"vert"===W?P.eq(n+r-1).css({marginBottom:lt-1}):P.eq(n+r-1).css({marginRight:lt-1});else if(u<0)for(n=1;n<=U-1;n+=V-1)for(r=1;r<=-u;r+=1)"vert"===W?(P.eq(n+r-1).css({marginBottom:lt+1}),N.css({height:parseInt(N.css("height"),10)+1})):(P.eq(n+r-1).css({marginRight:lt+1}),N.css({width:parseInt(N.css("width"),10)+1}));e.show_icon&&!e.magnifier_invert&&O.css({background:O.css("background-color")+" "+A.css("background-image")+" center no-repeat"}),e.hide_cursor&&O.add(A).css({cursor:"none"}),I&&pt.css({width:F.css("width"),height:F.css("height")});var Lt=x.first().find(".etalage_thumb_image"),Wt=x.first().find(".etalage_source_image");e.magnifier_invert&&Q.attr("src",Lt.data("src")).show(),C&&E.attr("src",Lt.data("src")),J.attr("src",Wt.attr("src")),e.show_descriptions&&(d=Wt.attr("title"))&&G.html(d).show();var xt=function(){_&&(clearInterval(_),_=!1)},Mt=function(){_&&xt(),_=setInterval(function(){Qt()},e.autoplay_interval)},jt=function(){1==e.zoom_enable&&(O.stop().fadeTo(b,m),A.stop().animate({opacity:0},b),Y.stop().show().animate({opacity:1},b),e.magnifier_invert&&Lt.stop().animate({opacity:e.magnifier_opacity},b),j&&xt())},Bt=function(a,i){var s,l,n=o.find(".etalage_smallthumb_active").removeClass("etalage_smallthumb_active");a.addClass("etalage_smallthumb_active"),i||(w=!0,n.stop(!0,!0).animate({opacity:e.smallthumb_inactive_opacity},b),a.stop(!0,!0).animate({opacity:1},b,function(){w=!1})),setTimeout(function(){o.find(".gallery-image").remove(),o.find(".etalage_thumb_image.hide").show().removeClass("hide")},500),o.find(".etalage_thumb_active").removeClass("etalage_thumb_active").stop().animate({opacity:0},e.speed,function(){t(this).hide()}),s=x.filter(".thumb_"+a.data("thumb_id")).addClass("etalage_thumb_active").show().stop().css({opacity:0}).animate({opacity:1},e.speed),Lt=s.find(".etalage_thumb_image"),Wt=s.find(".etalage_source_image"),e.magnifier_invert&&Q.attr("src",Lt.data("src")),C&&E.attr("src",Lt.data("src")),J.attr("src",Wt.attr("src")),e.show_descriptions&&((d=Wt.attr("title"))?G.html(d).show():G.hide()),j&&(xt(),Mt()),l=a.data("id"),M>=V&&l--,-1!=navigator.userAgent.toLowerCase().indexOf("firefox")&&(o.children("li.etalage_small_thumbs").css("overflow","visible"),setTimeout(function(){o.children("li.etalage_small_thumbs").css("overflow","hidden")},1)),Xt(l)},Ot=function(a,i,s,l){t.each(P,function(){var i=t(this),s={opacity:e.smallthumb_inactive_opacity};i.data("id")===l.data("id")&&(s.opacity=1),"vert"===W?s.top="-="+a:s.left="-="+a,i.animate(s,b,"swing",function(){w&&(l.addClass("etalage_smallthumb_active"),w=!1)})}),Bt(l,!0)},At=function(){var t=R-z,a=L-q;z-=-t/v,q-=-a/v,t<1&&t>-1&&(z=R),a<1&&a>-1&&(q=L),J.css({left:z,top:q}),C&&E.css({left:z,top:q}),(t>1||a>1||t<1||a<1)&&(T=setTimeout(function(){At()},25))},Ht=function(){var t;if(e.magnifier_invert&&o.find(".etalage_thumb_active").mouseleave(),e.right_to_left){if(!(t=o.find(".etalage_smallthumb_active").next()).length)return M>V?s():P.first().trigger("click"),!0}else if(!(t=o.find(".etalage_smallthumb_active").prev()).length)return M>V?l():P.last().trigger("click"),!0;t.trigger("click")},Qt=function(){var t;if(e.magnifier_invert&&o.find(".etalage_thumb_active").mouseleave(),e.right_to_left){if(!(t=o.find(".etalage_smallthumb_active").prev()).length)return M>V?l():P.last().trigger("click"),!0}else if(!(t=o.find(".etalage_smallthumb_active").next()).length)return M>V?s():P.first().trigger("click"),!0;t.trigger("click")};window[p+"_previous"]=function(){Ht()},window[p+"_next"]=function(){Qt()},window[p+"_show"]=function(t){!function(t){(M<=V||!e.show_begin_end_smallthumb)&&(t-=1);var a=P.eq(t);if(a.length&&!w){var i=o.find(".etalage_smallthumb_active").data("id")-1;if(i>t){y=i-t;var s=o.find(".etalage_smallthumb_first"),l=s.data("id");t<l?(y-=i-l,s.trigger("click")):Bt(a,!1)}else if(i<t){y=t-i;var n=o.find(".etalage_smallthumb_last"),r=n.data("id")-1;t>=r?(y-=r-i-1,n.trigger("click")):Bt(a,!1)}}}(t)};var Xt=function(t){e.change_callback(t,p)&&"function"==typeof etalage_change_callback&&etalage_change_callback(t,p)};x.add(O).add(A).mouseenter(function(){e.show_hint&&X.hide(),e.click_to_zoom&&!k||jt()}).mouseleave(function(){O.stop().fadeOut(e.speed),A.stop().animate({opacity:1},e.speed),Y.stop().animate({opacity:0},e.speed,function(){t(this).hide()}),e.magnifier_invert&&Lt.stop().animate({opacity:1},e.speed,function(){e.click_to_zoom&&(k=!1)}),clearTimeout(T),j&&Mt()});var Yt=-(e.source_image_width-mt),Dt=-(e.source_image_height-_t);x.add(O).add(A).mousemove(function(t){var a=Math.round(t.pageX-Lt.offset().left+wt),i=Math.round(t.pageY-Lt.offset().top+vt),s=a-qt,l=i-Rt;if(s<wt&&(s=wt),s>zt&&(s=zt),l<vt&&(l=vt),l>Tt&&(l=Tt),O.css({left:s,top:l}),e.magnifier_invert){var o=s-wt,n=l-vt;Q.css({left:-o,top:-n})}R=-(s-wt)*(1/(e.thumb_image_width/e.source_image_width)),L=-(l-vt)*(1/(e.thumb_image_height/e.source_image_height)),R<Yt&&(R=Yt),L<Dt&&(L=Dt),e.zoom_easing?(clearTimeout(T),At()):(C&&E.css({left:R,top:L}),J.css({left:R,top:L}))}),(M>1||!e.smallthumb_hide_single)&&(P.click(function(){var e=t(this);if(!e.hasClass("etalage_smallthumb_active")&&(!w||y))if(e.hasClass("etalage_smallthumb_first")&&e.prev().length)a("left");else if(e.hasClass("etalage_smallthumb_navtoend"))l();else if(e.hasClass("etalage_smallthumb_last")&&e.next().length)a("right");else if(e.hasClass("etalage_smallthumb_navtostart"))s();else{if(y&&!t(this).next().length)return l(),!0;if(y&&!t(this).prev().length)return s(),!0;Bt(e,!1)}}),e.smallthumb_select_on_hover&&P.mouseenter(function(){t(this).trigger("click")})),e.click_to_zoom?x.click(function(){k=!0,jt()}):O.click(function(){var t=Lt.data("anchor");t&&function(t){return!(!e.click_callback(t,p)||"function"==typeof etalage_click_callback&&(etalage_click_callback(t,p),1))}(t)&&(window.location=t)}),M>1&&e.keyboard&&t(document).keydown(function(t){39!==t.keyCode&&"39"!==t.keyCode||(e.right_to_left?Ht():Qt()),37!==t.keyCode&&"37"!==t.keyCode||(e.right_to_left?Qt():Ht())}),t(window).bind("load",function(){x.css({"background-image":"none"}),Y.css({"background-image":"none"}),C&&(C=!1,E.remove())}),j&&Mt()}}),this}}(jQuery);